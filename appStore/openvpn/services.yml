---
version: '2.3'
services:
  server:
    cap_add:
     - NET_ADMIN
    network_mode: "host"
    image: kylemanna/openvpn
    ports:
     - "1194:1194/udp"
    restart: always
    volumes:
     - openvpn-data:/etc/openvpn

  pki:
    image: kylemanna/openvpn
    network_mode: "host"
    restart: unless-stopped
    command: "/bin/bash -c 'trap : TERM INT; (while sleep 3600; do :; done) & wait'"
    volumes:
     - openvpn-data:/etc/openvpn
     - ./scripts/easyrsa.sh:/usr/local/bin/easyrsa
     - ./scripts/ovpn_initpki.sh:/usr/local/bin/ovpn_initpki
     - ./scripts/gen_client_ovpn.sh:/usr/local/bin/gen_client_ovpn
     - ./scripts/setup_vpn_server.sh:/usr/local/bin/setup_vpn_server
     - ./scripts/create_new_user.sh:/usr/local/bin/create_new_user
     - ./scripts/revoke_user.sh:/usr/local/bin/revoke_user

volumes:
  openvpn-data:
    driver: local

