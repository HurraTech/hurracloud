---
version: '2.2'
services:
  server:
    cap_add:
     - NET_ADMIN
    image: kylemanna/openvpn
    ports:
     - "1194:1194/udp"
    restart: always
    volumes:
     - openvpn-data:/etc/openvpn

  pki:
    image: kylemanna/openvpn
    restart: unless-stopped
    command: "/bin/bash -c 'trap : TERM INT; (while sleep 3600; do :; done) & wait'"
    volumes:
     - openvpn-data:/etc/openvpn
     - ./scripts/easyrsa.sh:/usr/local/bin/easyrsa
     - ./scripts/ovpn_initpki.sh:/usr/local/bin/ovpn_initpki

volumes:
  openvpn-data:
    driver: local
